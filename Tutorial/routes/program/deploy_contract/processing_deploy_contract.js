'use strict';
var express = require('express');
var router = express.Router();

var Web3 = require('web3');
var Tx = require('ethereumjs-tx');
const testnet = 'https://ropsten.infura.io/v3/7a262c3183f04a258e05c4bb0d989af0';
const web3 = new Web3(new Web3.providers.HttpProvider(testnet));
var token_wallet = "0xD0A8800973cbEF2639EbF79c019c8a1611C7d810";
var token_wallet_private_key = "839868E1D213AD69FD7BD0D6212F302D526D15BB16D2E5236A7EC116716D2C4D";

var contractAddress = '0x72682d0d54c7ED7cdDdAa66E6DD7171f2B9c626C';//Token合約位址
var contractABI =[{"constant":false,"inputs":[{"name":"CopyMatch","type":"address"}],"name":"proxy_ActiveStrategy","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_signature","type":"bytes"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"},{"name":"_fee","type":"uint256"},{"name":"_nonce","type":"uint256"}],"name":"transferPreSigned","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"hash","type":"bytes32"},{"name":"sig","type":"bytes"}],"name":"recover","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"getNonce","outputs":[{"name":"nonce","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"CopyMatch","type":"address"}],"name":"proxy_inActiveStrategy","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_signature","type":"bytes"},{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"},{"name":"_fee","type":"uint256"},{"name":"_nonce","type":"uint256"}],"name":"approvePreSigned","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_subtractedValue","type":"uint256"}],"name":"decreaseApproval","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"Initial_Supply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"CopyMatch","type":"address"},{"name":"addrCopyTrader","type":"address"},{"name":"id","type":"uint256"},{"name":"endAmount","type":"uint256"}],"name":"proxy_endCommit","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_signature","type":"bytes"},{"name":"_spender","type":"address"},{"name":"_subtractedValue","type":"uint256"},{"name":"_fee","type":"uint256"},{"name":"_nonce","type":"uint256"}],"name":"decreaseApprovalPreSigned","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_signature","type":"bytes"},{"name":"_spender","type":"address"},{"name":"_addedValue","type":"uint256"},{"name":"_fee","type":"uint256"},{"name":"_nonce","type":"uint256"}],"name":"increaseApprovalPreSigned","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_signature","type":"bytes"},{"name":"_to","type":"address"},{"name":"_controlId","type":"uint256"},{"name":"_fee","type":"uint256"},{"name":"_nonce","type":"uint256"},{"name":"CopyMatch","type":"address"},{"name":"addrCopyTrader","type":"address"},{"name":"id","type":"uint256"},{"name":"amount","type":"uint256"},{"name":"otherData","type":"string"},{"name":"endAmount","type":"uint256"}],"name":"controlPreSigned","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"CopyMatch","type":"address"},{"name":"addrCopyTrader","type":"address"},{"name":"id","type":"uint256"},{"name":"amount","type":"uint256"},{"name":"otherData","type":"string"}],"name":"proxy_createCommit","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_addedValue","type":"uint256"}],"name":"increaseApproval","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_token","type":"address"},{"name":"_functionSig","type":"bytes4"},{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"},{"name":"_fee","type":"uint256"},{"name":"_nonce","type":"uint256"}],"name":"recoverPreSignedHash","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"ControlPreSigned_Transfer_Fee","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":true,"name":"delegate","type":"address"},{"indexed":false,"name":"_controlId","type":"uint256"},{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"fee","type":"uint256"}],"name":"ControlPreSigned","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"TransferPreSigned_Transfer_Fee","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":true,"name":"delegate","type":"address"},{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"fee","type":"uint256"}],"name":"TransferPreSigned","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":true,"name":"delegate","type":"address"},{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"fee","type":"uint256"}],"name":"ApprovalPreSigned","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"existingOwner","type":"address"},{"indexed":true,"name":"newOwner","type":"address"}],"name":"transferOwner","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"}]
var contract = web3.eth.contract(contractABI).at(contractAddress);

router.post('/', function (req, res) {

    /*
    res.render('program/processing_deploy_contract', {
        date: req.body.date,
        result: "Success",
        //tx_hash: tx_hash,
        total_exchange: req.body.num_cash
    });
    */

    

    var pool = req.connection;

    pool.getConnection(function (err, connection) {
        connection.query('SELECT * FROM user_information WHERE user_id = ?', [req.session.user_id], function (err, rows) {
            if (err) {
                res.render('error', {
                    message: err.message,
                    error: err
                });
            }
            else {

                var wallet_address = rows[0].user_wallet_address; //欲轉出Token之錢包
                var total_exchange = req.body.num_cash;//兌換數量(暫時以付出金額替代,因為1:1)
                var total_exchange = total_exchange * Math.pow(10, 18);//Token decimal=18
                //var count = web3.eth.getTransactionCount(token_wallet);//發幣錢包位址
                //var wallet_private_key = req.body.private_key;

                var sign = req.body.signature;
                var to = token_wallet;
                var val = total_exchange;
                var fee = req.body.fee;
                var nonce = req.body.nonce;
                var count = web3.eth.getTransactionCount(token_wallet);//發幣錢包位址 count不能放外面 不然連續交易兩次會錯(外面不會刷新)


                //Tokens Transfer
                var rawTransaction = {
                    "from": token_wallet,
                    "nonce": web3.toHex(count),
                    "gasPrice": web3.toHex(21000000000),
                    "gasLimit": web3.toHex(200000),
                    "to": contractAddress,
                    "value": "0x0",
                    "data": contract.transferPreSigned.getData(sign, to, val, fee, nonce)//轉100枚Token
                };
                //Token_wallet private_key
                var privateKey = new Buffer(token_wallet_private_key, 'hex');
                var tx = new Tx(rawTransaction);

                tx.sign(privateKey);
                var serializedTx = tx.serialize();

                web3.eth.sendRawTransaction('0x' + serializedTx.toString('hex'), function (err, hash) {
                    if (!err) {
                        var tx_hash = hash;
                        console.log(hash);

                        var count2 = count + 1;
                        var deploy_data = '0x60806040526105dc6002556103e86003556000600760146101000a81548160ff0219169083151502179055503480156200003857600080fd5b5033600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600080819055506001600760146101000a81548160ff0219169083151502179055506000600960006101000a81548160ff02191690831515021790555060006001819055507fd614ec5b89a3ac84bc28f188c189c2e607801ca2774490d55d3eac6eecf399a6600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600054600760149054906101000a900460ff16600960009054906101000a900460ff166001546040516200013c9594939291906200017d565b60405180910390a162000224565b6200015581620001da565b82525050565b6200016681620001ee565b82525050565b62000177816200021a565b82525050565b600060a0820190506200019460008301886200014a565b620001a360208301876200016c565b620001b260408301866200015b565b620001c160608301856200015b565b620001d060808301846200016c565b9695505050505050565b6000620001e782620001fa565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b61422280620002346000396000f3fe608060405260043610610180576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806307da0603146101bc57806308da06ff146101e75780630e4eaa82146102125780631021eaa81461023d5780631065ebda1461026857806312494160146102af578063149e9fd0146102da57806328b9e23a146103055780632f23116314610342578063332639281461036d5780633af6d908146103aa57806341c0e1b5146103e75780637b82363f146103fe57806384bf15351461043b5780638da5cb5b1461048157806395d89b41146104ac578063a8c62e76146104d7578063b6fa27b214610508578063b923720314610545578063baafd2c214610582578063c57f3f1f146105ad578063c9e03331146105ea578063ccbf243114610615578063cf2a664814610653578063d71a65d71461067e578063dbd44d42146106a9578063debedc70146106d4578063def65bf414610711578063e737d85b1461074f578063ee152a1a1461078c575b7fedf4dd9e972394b4cf71927c064aedca94905064a8a44da1ff31fc055950b29d6000366040516101b2929190613e51565b60405180910390a1005b3480156101c857600080fd5b506101d16107b7565b6040516101de9190613ef5565b60405180910390f35b3480156101f357600080fd5b506101fc610885565b6040516102099190613b99565b60405180910390f35b34801561021e57600080fd5b506102276108ab565b6040516102349190613b99565b60405180910390f35b34801561024957600080fd5b506102526108d1565b60405161025f9190613f2b565b60405180910390f35b34801561027457600080fd5b5061028f600480360361028a9190810190613704565b6108d7565b6040516102a69b9a99989796959493929190613da6565b60405180910390f35b3480156102bb57600080fd5b506102c4610bb9565b6040516102d19190613c79565b60405180910390f35b3480156102e657600080fd5b506102ef610bcc565b6040516102fc9190613c79565b60405180910390f35b34801561031157600080fd5b5061032c600480360361032791908101906135fd565b610d45565b6040516103399190613f2b565b60405180910390f35b34801561034e57600080fd5b50610357610df0565b6040516103649190613f2b565b60405180910390f35b34801561037957600080fd5b50610394600480360361038f919081019061380a565b610df6565b6040516103a19190613b99565b60405180910390f35b3480156103b657600080fd5b506103d160048036036103cc919081019061378f565b610e29565b6040516103de9190613c79565b60405180910390f35b3480156103f357600080fd5b506103fc61133d565b005b34801561040a57600080fd5b50610425600480360361042091908101906135fd565b6113d4565b6040516104329190613f2b565b60405180910390f35b34801561044757600080fd5b50610462600480360361045d9190810190613704565b6113ec565b6040516104789a99989796959493929190613d03565b60405180910390f35b34801561048d57600080fd5b506104966114f2565b6040516104a39190613b99565b60405180910390f35b3480156104b857600080fd5b506104c1611518565b6040516104ce9190613e75565b60405180910390f35b3480156104e357600080fd5b506104ec6115b6565b6040516104ff9796959493929190613c94565b60405180910390f35b34801561051457600080fd5b5061052f600480360361052a9190810190613740565b6115f3565b60405161053c9190613c79565b60405180910390f35b34801561055157600080fd5b5061056c60048036036105679190810190613833565b611c0a565b6040516105799190613c79565b60405180910390f35b34801561058e57600080fd5b506105976122a0565b6040516105a49190613b99565b60405180910390f35b3480156105b957600080fd5b506105d460048036036105cf9190810190613740565b6122c6565b6040516105e19190613f10565b60405180910390f35b3480156105f657600080fd5b506105ff6123b3565b60405161060c9190613f2b565b60405180910390f35b34801561062157600080fd5b5061063c60048036036106379190810190613740565b612419565b60405161064a92919061404d565b60405180910390f35b34801561065f57600080fd5b50610668612457565b6040516106759190613f2b565b60405180910390f35b34801561068a57600080fd5b5061069361245d565b6040516106a09190613c79565b60405180910390f35b3480156106b557600080fd5b506106be6125cf565b6040516106cb9190613c79565b60405180910390f35b3480156106e057600080fd5b506106fb60048036036106f69190810190613740565b6125e2565b6040516107089190613c57565b60405180910390f35b34801561071d57600080fd5b50610738600480360361073391908101906138aa565b6126a3565b60405161074692919061404d565b60405180910390f35b34801561075b57600080fd5b5061077660048036036107719190810190613626565b6126e1565b6040516107839190613c79565b60405180910390f35b34801561079857600080fd5b506107a161292b565b6040516107ae9190613f2b565b60405180910390f35b6107bf61332b565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561081b57600080fd5b600a60e060405190810160405290816000820160009054906101000a900460ff161515151581526020016001820154815260200160028201548152602001600382015481526020016004820154815260200160058201548152602001600682015481525050905090565b600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60025481565b6000806000806000806000806000806000600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561094457600080fd5b60008d905060008d905061095661336e565b601160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600083815260200190815260200160002061014060405190810160405290816000820160009054906101000a900460ff161515151581526020016001820154815260200160028201548152602001600382015481526020016004820154815260200160058201548152602001600682015481526020016007820154815260200160088201548152602001600982018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610ab75780601f10610a8c57610100808354040283529160200191610ab7565b820191906000526020600020905b815481529060010190602001808311610a9a57829003601f168201915b505050505081525050905060008161010001519050610ad46133c4565b601460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008581526020019081526020016000206000838152602001908152602001600020604080519081016040529081600082015481526020016001820154815250509050826000015183602001518460400151856060015186608001518760a001518860c001518960e001518a610100015189600001518a602001519f509f509f509f509f509f509f509f509f509f509f5050505050509295989b509295989b9093969950565b600760149054906101000a900460ff1681565b6000600760149054906101000a900460ff161515610be957600080fd5b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161480610c925750600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b1515610c9d57600080fd5b60001515600a60000160009054906101000a900460ff161515141515610cc257600080fd5b6001600a60000160006101000a81548160ff0219169083151502179055507f759ca757c11347ae925e51e7da2fd6dbe792b6e986bcfdbeab8a420c314e11ac6008600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1642604051610d3693929190613e97565b60405180910390a16001905090565b6000600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610da357600080fd5b6000601260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905080915050919050565b60005481565b60136020528060005260406000206000915054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6000600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161480610ed45750600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b1515610edf57600080fd5b6000841415610eef576001840193505b600a60000160009054906101000a900460ff161515610f0d57600080fd5b60011515601160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600086815260200190815260200160002060000160009054906101000a900460ff16151514151515610f8157600080fd5b610f8961336e565b600181600001901515908115158152505060018501601260008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055504281602001818152505042816040018181525050600185141561106e576110136001805461293190919063ffffffff16565b6001819055508560136000600154815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b600061107985612952565b90506000859050611093828261293190919063ffffffff16565b90506110aa6002548261293190919063ffffffff16565b9050858360600181815250508183608001818152505060008360a001818152505082606001518360c001818152505060008360e00181815250506110fd600184610100015161293190919063ffffffff16565b836101000181815250508483610120018190525082601160008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600089815260200190815260200160002060008201518160000160006101000a81548160ff0219169083151502179055506020820151816001015560408201518160020155606082015181600301556080820151816004015560a0820151816005015560c0820151816006015560e0820151816007015561010082015181600801556101208201518160090190805190602001906111f09291906133de565b509050506000836020015190507fc7d6a166c706e957859bb76737df3a5d79f7978807487bb61ee9896f76941a3c6000548a8a8a85604051611236959493929190613f99565b60405180910390a16000611249826129a2565b9050600061125683612a4d565b9050600061126384612a63565b60ff1690506112ba8a601560008661ffff16815260200190815260200160002060008560ff16815260200190815260200160002060008481526020019081526020016000206000015461293190919063ffffffff16565b601560008561ffff16815260200190815260200160002060008460ff1681526020019081526020016000206000838152602001908152602001600020600001819055506000876000019015159081151581525050611324600160005461293190919063ffffffff16565b6000819055506001975050505050505050949350505050565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561139957600080fd5b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b60126020528060005260406000206000915090505481565b6011602052816000526040600020602052806000526040600020600091509150508060000160009054906101000a900460ff1690806001015490806002015490806003015490806004015490806005015490806006015490806007015490806008015490806009018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114e85780601f106114bd576101008083540402835291602001916114e8565b820191906000526020600020905b8154815290600101906020018083116114cb57829003601f168201915b505050505090508a565b600660009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60088054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156115ae5780601f10611583576101008083540402835291602001916115ae565b820191906000526020600020905b81548152906001019060200180831161159157829003601f168201915b505050505081565b600a8060000160009054906101000a900460ff16908060010154908060020154908060030154908060040154908060050154908060060154905087565b6000600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16148061169e5750600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b15156116a957600080fd5b601160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600084815260200190815260200160002060000160009054906101000a900460ff16151561171557600080fd5b61171d61336e565b601160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600085815260200190815260200160002061014060405190810160405290816000820160009054906101000a900460ff161515151581526020016001820154815260200160028201548152602001600382015481526020016004820154815260200160058201548152602001600682015481526020016007820154815260200160088201548152602001600982018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561187e5780601f106118535761010080835404028352916020019161187e565b820191906000526020600020905b81548152906001019060200180831161186157829003601f168201915b5050505050815250509050600081600001901515908115158152505042816040018181525050600080611904601160008973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008881526020019081526020016000206003015486612a79565b809250819350505061192381846080015161293190919063ffffffff16565b83608001818152505060008360a001818152505061194a8186612ae890919063ffffffff16565b8360c00181815250506040805190810160405280601b81526020017f54686520656e64206f6620636f6d6d69742c20737461727465643a000000000081525083610120018190525061199c8787612b0a565b15156119a757600080fd5b82601160008973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600088815260200190815260200160002060008201518160000160006101000a81548160ff0219169083151502179055506020820151816001015560408201518160020155606082015181600301556080820151816004015560a0820151816005015560c0820151816006015560e082015181600701556101008201518160080155610120820151816009019080519060200190611a869291906133de565b50905050600087905060008790507f249dc55d05128442712d6a8fb93151cf0e0971928b1e47a31a710154264a63196000548a838a601160008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000878152602001908152602001600020600101548a60400151604051611b2696959493929190613fec565b60405180910390a16000856040015190506000611b42826129a2565b90506000611b4f83612a4d565b90506000611b5c84612a63565b60ff169050611bb38b601560008661ffff16815260200190815260200160002060008560ff16815260200190815260200160002060008481526020019081526020016000206001015461293190919063ffffffff16565b601560008561ffff16815260200190815260200160002060008460ff168152602001908152602001600020600083815260200190815260200160002060010181905550600199505050505050505050509392505050565b6000600760149054906101000a900460ff161515611c2757600080fd5b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161480611cd05750600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b1515611cdb57600080fd5b6000600a6001015490508086141515611d29576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611d2090613ed5565b60405180910390fd5b611d3161336e565b601160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600085815260200190815260200160002061014060405190810160405290816000820160009054906101000a900460ff161515151581526020016001820154815260200160028201548152602001600382015481526020016004820154815260200160058201548152602001600682015481526020016007820154815260200160088201548152602001600982018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611e925780601f10611e6757610100808354040283529160200191611e92565b820191906000526020600020905b815481529060010190602001808311611e7557829003601f168201915b505050505081525050905060008161010001519050611eaf6133c4565b601460008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000878152602001908152602001600020600083815260200190815260200160002060408051908101604052908160008201548152602001600182015481525050905060008360c001519050611f518460a0015182612ae890919063ffffffff16565b90508815611fc1578a8110151515611f6857600080fd5b611f7f8b8560a0015161293190919063ffffffff16565b8460a0018181525050428260000181815250508a826020018181525050611fb38b8560c00151612ae890919063ffffffff16565b8460c001818152505061202c565b611fd88b8560a00151612ae890919063ffffffff16565b8460a0018181525050428260000181815250506120028b8360200151612ae890919063ffffffff16565b8260200181815250506120228b8560c0015161293190919063ffffffff16565b8460c00181815250505b612045600185610100015161293190919063ffffffff16565b8461010001818152505083601160008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600089815260200190815260200160002060008201518160000160006101000a81548160ff0219169083151502179055506020820151816001015560408201518160020155606082015181600301556080820151816004015560a0820151816005015560c0820151816006015560e08201518160070155610100820151816008015561012082015181600901908051906020019061212e9291906133de565b509050508160000151601460008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008981526020019081526020016000206000858152602001908152602001600020600001819055508160200151601460008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008981526020019081526020016000206000858152602001908152602001600020600101819055507f8bb2aadc1ad5273a31b40b05081c55bbbfa1926ac5bb52e679ec8e6de6f44fdc601260008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054898d8c8660000151604051612286959493929190613f46565b60405180910390a160019550505050505095945050505050565b600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6122ce6133c4565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561232a57600080fd5b601460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600084815260200190815260200160002060008381526020019081526020016000206040805190810160405290816000820154815260200160018201548152505090509392505050565b6000600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561241157600080fd5b600054905090565b601460205282600052604060002060205281600052604060002060205280600052604060002060009250925050508060000154908060010154905082565b60035481565b6000600760149054906101000a900460ff16151561247a57600080fd5b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806125235750600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b151561252e57600080fd5b600a60000160009054906101000a900460ff16151561254c57600080fd5b6000600a60000160006101000a81548160ff0219169083151502179055507f8bc40a9c6b0cddee6e85c476acea4aae97afc760790d68ab2026b1ce839bf50f6008600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16426040516125c093929190613e97565b60405180910390a16001905090565b600960009054906101000a900460ff1681565b6060600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561264057600080fd5b60606000600190505b61265d60018561293190919063ffffffff16565b8110156126975761266f8686836122c6565b828281518110151561267d57fe5b906020019060200201819052508080600101915050612649565b50809150509392505050565b601560205282600052604060002060205281600052604060002060205280600052604060002060009250925050508060000154908060010154905082565b6000801515600960009054906101000a900460ff16151514151561270457600080fd5b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561276057600080fd5b89600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555088600760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555087600890805190602001906127f892919061345e565b5086600a6001018190555085600a6002018190555084600a6003018190555083600a6004018190555082600a6005018190555081600a600601819055506001600a60000160006101000a81548160ff0219169083151502179055506001600960006101000a81548160ff0219169083151502179055507fd703944b512ece1db669c43f28d74828de79542d8c2a0c2b81544c15d98f51af600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1660088a8a8a8a8a8a426040516128f49a99989796959493929190613bb4565b60405180910390a16001600a60000160006101000a81548160ff021916908315150217905550600190509998505050505050505050565b60015481565b600080828401905083811015151561294857600080fd5b8091505092915050565b600080612997600a60050154612989606461297b87600a60040154612f1190919063ffffffff16565b612f4f90919063ffffffff16565b61293190919063ffffffff16565b905080915050919050565b600080600090506000806301e13380858115156129bb57fe5b046107b261ffff160191506129d56107b261ffff16612f79565b6129e28361ffff16612f79565b039050806301e285000283019250806107b2830361ffff16036301e1338002830192505b84831115612a4257612a1a60018303612fb2565b15612a2d576301e2850083039250612a37565b6301e13380830392505b600182039150612a06565b819350505050919050565b6000612a5882613033565b602001519050919050565b6000612a6e82613033565b604001519050919050565b6000806000808585101515612ad057612ac56064612ab7612aa38989612ae890919063ffffffff16565b600a60060154612f1190919063ffffffff16565b612f4f90919063ffffffff16565b905060009150612ad9565b60009050600191505b81819350935050509250929050565b6000828211151515612af957600080fd5b600082840390508091505092915050565b6000600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161480612bb55750600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b1515612bc057600080fd5b612bc861336e565b601160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600084815260200190815260200160002061014060405190810160405290816000820160009054906101000a900460ff161515151581526020016001820154815260200160028201548152602001600382015481526020016004820154815260200160058201548152602001600682015481526020016007820154815260200160088201548152602001600982018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612d295780601f10612cfe57610100808354040283529160200191612d29565b820191906000526020600020905b815481529060010190602001808311612d0c57829003601f168201915b505050505081525050905060008161010001519050612d466133c4565b601460008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000868152602001908152602001600020600083815260200190815260200160002060408051908101604052908160008201548152602001600182015481525050905082600001511515612dd857600080fd5b4281600001818152505060008160200181815250508060000151601460008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008781526020019081526020016000206000848152602001908152602001600020600001819055508060200151601460008873ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008781526020019081526020016000206000848152602001908152602001600020600101819055507f4ac2e0368cb5a38bd4a105c82cf4ccb92ab630ca0c9c1a11aab6afa91d7d69e4828260000151604051612efc92919061404d565b60405180910390a16001935050505092915050565b600080831415612f245760009050612f49565b60008284029050828482811515612f3757fe5b04141515612f4457600080fd5b809150505b92915050565b60008082111515612f5f57600080fd5b60008284811515612f6c57fe5b0490508091505092915050565b600060018203915061019082811515612f8e57fe5b04606483811515612f9b57fe5b04600484811515612fa857fe5b0403019050919050565b60008060048361ffff16811515612fc557fe5b0661ffff16141515612fda576000905061302e565b600060648361ffff16811515612fec57fe5b0661ffff16141515613001576001905061302e565b60006101908361ffff1681151561301457fe5b0661ffff16141515613029576000905061302e565b600190505b919050565b61303b6134de565b600080905060008061304c856129a2565b846000019061ffff16908161ffff168152505061306e6107b261ffff16612f79565b61307f856000015161ffff16612f79565b039150816301e285000283019250816107b285600001510361ffff16036301e1338002830192506000600191505b600c8260ff16111515613105576130c88286600001516131d4565b60ff16620151800290508584820111156130f35781856020019060ff16908160ff1681525050613105565b808401935081806001019250506130ad565b600191505b61311c856020015186600001516131d4565b60ff168260ff161115156131635785846201518001111561314e5781856040019060ff16908160ff1681525050613163565b6201518084019350818060010192505061310a565b61316c866132a0565b856060019060ff16908160ff1681525050613186866132cd565b856080019060ff16908160ff16815250506131a0866132ee565b8560a0019060ff16908160ff16815250506131ba86613304565b8560c0019060ff16908160ff168152505050505050919050565b600060018360ff1614806131eb575060038360ff16145b806131f9575060058360ff16145b80613207575060078360ff16145b80613215575060088360ff16145b806132235750600a8360ff16145b806132315750600c8360ff16145b1561323f57601f905061329a565b60048360ff161480613254575060068360ff16145b80613262575060098360ff16145b806132705750600b8360ff16145b1561327e57601e905061329a565b61328782612fb2565b1561329557601d905061329a565b601c90505b92915050565b60006018603c80848115156132b157fe5b048115156132bb57fe5b048115156132c557fe5b069050919050565b6000603c80838115156132dc57fe5b048115156132e657fe5b069050919050565b6000603c828115156132fc57fe5b069050919050565b600060076004620151808481151561331857fe5b040181151561332357fe5b069050919050565b60e0604051908101604052806000151581526020016000801916815260200160008152602001600081526020016000815260200160008152602001600081525090565b610140604051908101604052806000151581526020016000815260200160008152602001600081526020016000815260200160008152602001600081526020016000815260200160008152602001606081525090565b604080519081016040528060008152602001600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061341f57805160ff191683800117855561344d565b8280016001018555821561344d579182015b8281111561344c578251825591602001919060010190613431565b5b50905061345a9190613532565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061349f57805160ff19168380011785556134cd565b828001600101855582156134cd579182015b828111156134cc5782518255916020019190600101906134b1565b5b5090506134da9190613532565b5090565b60e060405190810160405280600061ffff168152602001600060ff168152602001600060ff168152602001600060ff168152602001600060ff168152602001600060ff168152602001600060ff1681525090565b61355491905b80821115613550576000816000905550600101613538565b5090565b90565b60006135638235614163565b905092915050565b60006135778235614175565b905092915050565b600061358b8235614181565b905092915050565b600082601f83011215156135a657600080fd5b81356135b96135b4826140a3565b614076565b915080825260208301602083018583830111156135d557600080fd5b6135e0838284614195565b50505092915050565b60006135f5823561418b565b905092915050565b60006020828403121561360f57600080fd5b600061361d84828501613557565b91505092915050565b60008060008060008060008060006101208a8c03121561364557600080fd5b60006136538c828d01613557565b99505060206136648c828d01613557565b98505060408a013567ffffffffffffffff81111561368157600080fd5b61368d8c828d01613593565b975050606061369e8c828d0161357f565b96505060806136af8c828d016135e9565b95505060a06136c08c828d016135e9565b94505060c06136d18c828d016135e9565b93505060e06136e28c828d016135e9565b9250506101006136f48c828d016135e9565b9150509295985092959850929598565b6000806040838503121561371757600080fd5b600061372585828601613557565b9250506020613736858286016135e9565b9150509250929050565b60008060006060848603121561375557600080fd5b600061376386828701613557565b9350506020613774868287016135e9565b9250506040613785868287016135e9565b9150509250925092565b600080600080608085870312156137a557600080fd5b60006137b387828801613557565b94505060206137c4878288016135e9565b93505060406137d5878288016135e9565b925050606085013567ffffffffffffffff8111156137f257600080fd5b6137fe87828801613593565b91505092959194509250565b60006020828403121561381c57600080fd5b600061382a848285016135e9565b91505092915050565b600080600080600060a0868803121561384b57600080fd5b6000613859888289016135e9565b955050602061386a8882890161357f565b945050604061387b8882890161356b565b935050606061388c88828901613557565b925050608061389d888289016135e9565b9150509295509295909350565b6000806000606084860312156138bf57600080fd5b60006138cd868287016135e9565b93505060206138de868287016135e9565b92505060406138ef868287016135e9565b9150509250925092565b61390281614111565b82525050565b6000613913826140ee565b808452602084019350613925836140cf565b60005b828110156139575761393b868351613b5b565b61394482614104565b9150604086019550600181019050613928565b50849250505092915050565b61396c81614123565b82525050565b61397b8161412f565b82525050565b6000828452602084019350613997838584614195565b6139a0836141d7565b840190509392505050565b60006139b6826140f9565b8084526139ca8160208601602086016141a4565b6139d3816141d7565b602085010191505092915050565b6000815460018116600081146139fe5760018114613a1e57613a5f565b607f600283041680865260ff198316602087015260408601935050613a5f565b60028204808652602086019550613a34856140dc565b60005b82811015613a5657815481890152600182019150602081019050613a37565b80880195505050505b505092915050565b6000601582527f7468652073747261746567792069732077726f6e6700000000000000000000006020830152604082019050919050565b60e082016000820151613ab46000850182613963565b506020820151613ac76020850182613972565b506040820151613ada6040850182613b8a565b506060820151613aed6060850182613b8a565b506080820151613b006080850182613b8a565b5060a0820151613b1360a0850182613b8a565b5060c0820151613b2660c0850182613b8a565b50505050565b604082016000820151613b426000850182613b8a565b506020820151613b556020850182613b8a565b50505050565b604082016000820151613b716000850182613b8a565b506020820151613b846020850182613b8a565b50505050565b613b9381614159565b82525050565b6000602082019050613bae60008301846138f9565b92915050565b600061014082019050613bca600083018d6138f9565b613bd7602083018c6138f9565b8181036040830152613be9818b6139e1565b9050613bf8606083018a613972565b613c056080830189613b8a565b613c1260a0830188613b8a565b613c1f60c0830187613b8a565b613c2c60e0830186613b8a565b613c3a610100830185613b8a565b613c48610120830184613b8a565b9b9a5050505050505050505050565b60006020820190508181036000830152613c718184613908565b905092915050565b6000602082019050613c8e6000830184613963565b92915050565b600060e082019050613ca9600083018a613963565b613cb66020830189613972565b613cc36040830188613b8a565b613cd06060830187613b8a565b613cdd6080830186613b8a565b613cea60a0830185613b8a565b613cf760c0830184613b8a565b98975050505050505050565b600061014082019050613d19600083018d613963565b613d26602083018c613b8a565b613d33604083018b613b8a565b613d40606083018a613b8a565b613d4d6080830189613b8a565b613d5a60a0830188613b8a565b613d6760c0830187613b8a565b613d7460e0830186613b8a565b613d82610100830185613b8a565b818103610120830152613d9581846139ab565b90509b9a5050505050505050505050565b600061016082019050613dbc600083018e613963565b613dc9602083018d613b8a565b613dd6604083018c613b8a565b613de3606083018b613b8a565b613df0608083018a613b8a565b613dfd60a0830189613b8a565b613e0a60c0830188613b8a565b613e1760e0830187613b8a565b613e25610100830186613b8a565b613e33610120830185613b8a565b613e41610140830184613b8a565b9c9b505050505050505050505050565b60006020820190508181036000830152613e6c818486613981565b90509392505050565b60006020820190508181036000830152613e8f81846139ab565b905092915050565b60006060820190508181036000830152613eb181866139e1565b9050613ec060208301856138f9565b613ecd6040830184613b8a565b949350505050565b60006020820190508181036000830152613eee81613a67565b9050919050565b600060e082019050613f0a6000830184613a9e565b92915050565b6000604082019050613f256000830184613b2c565b92915050565b6000602082019050613f406000830184613b8a565b92915050565b600060a082019050613f5b6000830188613b8a565b613f6860208301876138f9565b613f756040830186613b8a565b613f826060830185613963565b613f8f6080830184613b8a565b9695505050505050565b600060a082019050613fae6000830188613b8a565b613fbb60208301876138f9565b613fc86040830186613b8a565b613fd56060830185613b8a565b613fe26080830184613b8a565b9695505050505050565b600060c0820190506140016000830189613b8a565b61400e60208301886138f9565b61401b6040830187613b8a565b6140286060830186613b8a565b6140356080830185613b8a565b61404260a0830184613b8a565b979650505050505050565b60006040820190506140626000830185613b8a565b61406f6020830184613b8a565b9392505050565b6000604051905081810181811067ffffffffffffffff8211171561409957600080fd5b8060405250919050565b600067ffffffffffffffff8211156140ba57600080fd5b601f19601f8301169050602081019050919050565b6000602082019050919050565b60008160005260206000209050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b600061411c82614139565b9050919050565b60008115159050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600061416e82614139565b9050919050565b60008115159050919050565b6000819050919050565b6000819050919050565b82818337600083830152505050565b60005b838110156141c25780820151818401526020810190506141a7565b838111156141d1576000848401525b50505050565b6000601f19601f830116905091905056fea265627a7a7230582030d12e02f6ca570e557ce0b249c914b284ce519180ff6b3c7722827985e324796c6578706572696d656e74616cf50037';
                        var deploy_rawTransaction = {
                            "from": token_wallet,
                            "nonce": web3.toHex(count2),
                            "gasPrice": web3.toHex(5000000000),
                            "gasLimit": web3.toHex(5000000),
                            "data": deploy_data
                        };


                        var deploy_tx = new Tx(deploy_rawTransaction);

                        deploy_tx.sign(privateKey);
                        var deploy_serializedTx = deploy_tx.serialize();

                        web3.eth.sendRawTransaction('0x' + deploy_serializedTx.toString('hex'), function (err, hash2) {
                            if (!err) {
                                console.log(hash2);
                                var tx_deploy_contract = hash2;
                                setTimeout(function () {
                                    var receipt = web3.eth.getTransactionReceipt(hash2);
                                    console.log(receipt.contractAddress);
                                    var deploy_address = receipt.contractAddress;
                                    connection.query('UPDATE user_information SET deploy_contract_address = ? WHERE user_id = ?', [deploy_address, req.session.user_id], function (err, rows) {
                                        if (err) {
                                            console.log("address fail");
                                        }
                                        else {
                                            console.log("address succ");

                                        }
                                    });
                                }, 90000);
                                return res.render('program/deploy_contract/processing_deploy_contract', {
                                    date: req.body.date,
                                    result: "Success",
                                    tx_hash: tx_hash,
                                    tx_deploy_contract: tx_deploy_contract,
                                    total_exchange: req.body.num_cash
                                });




                            }
                            else {
                                console.log(err);
                                return res.render('program/deploy_contract/processing_deploy_contract', {
                                    date: req.body.date,
                                    result: "Fail",
                                    total_exchange: req.body.num_cash
                                });
                            }
                        });


                    }
                    else {

                        return res.render('program/deploy_contract/processing_deploy_contract', {
                            date: req.body.date,
                            result: "Fail",
                            total_exchange: req.body.num_cash
                        });

                    }
                });
                

            }
        });

        connection.release();

    });
    


});

module.exports = router;